var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(g){b.reject(g)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(e){c||(c=!0,a.call(b,e))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(g){this.reject_(g);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(m){f(m)}}:b}var d,f,h=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return h};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,e){for(var d=$jscomp.makeIterator(a),f=d.next();!f.done;f=d.next())c(f.value).callWhenSettled_(b,
e)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){h[b]=c;g--;0==g&&a(h)}}var h=[],g=0;do h.push(void 0),g++,c(d.value).callWhenSettled_(f(h.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(a){return this.then(function(b){return Promise.resolve(a()).then(function(){return b})},function(b){return Promise.resolve(a()).then(function(){throw b;})})}},"es9","es3");var buildvers="0.4.4",builddate="2020.06.21",devmode=!1,traceajax=function(){};if("undefined"===typeof $.fn.popover)throw Error("Bootstrap library required");String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!==typeof a[c]?a[c]:b})});
String.prototype.printf||(String.prototype.printf=function(){var a=Array.prototype.slice.call(arguments),b=-1;return this.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(c,d,e,f,h,k){if("%%"===c)return"%";if(void 0!==a[++b]){c=f?parseInt(f.substr(1)):void 0;f=h?parseInt(h.substr(1)):void 0;switch(k){case "s":var g=a[b];break;case "c":g=a[b][0];break;case "f":g=parseFloat(a[b]).toFixed(c);break;case "p":g=parseFloat(a[b]).toPrecision(c);break;case "e":g=parseFloat(a[b]).toExponential(c);
break;case "x":g=parseInt(a[b]).toString(f?f:16);break;case "d":g=parseFloat(parseInt(a[b],f?f:10).toPrecision(c)).toFixed(0)}g="object"===typeof g?JSON.stringify(g):g.toString(f);c=parseInt(e);for(e=e&&"0"===e[0]?"0":" ";g.length<c;)g=void 0!==d?g+e:e+g;return g}})});
var fmtfilesize=function(a){return 1536>a?a+" bytes":1048576>a?(a/1024).toPrecision(3)+" kB":1073741824>a?(a/1048576).toPrecision(3)+" MB":1099511627776>a?(a/1073741824).toPrecision(3)+" GB":(a/1099511627776).toPrecision(3)+" TB"},fmtitemsize=function(a){return 1536>a?fmtfilesize(a):"%s (%d bytes)".printf(fmtfilesize(a),a)},fmttime=function(a,b){var c=function(a,b){a=Math.floor(a).toString();b-=a.length;return 0<b?"0".repeat(b)+a:a};if(60>b)return c(a,2);if(3600>b)return b=a%60,c(a/60,2)+":"+c(b,
2);b=a%60;var d=a%3600/60;return c(a/3600,2)+":"+c(d,2)+":"+c(b,2)},makestrid=function(a){for(var b="",c=0;c<a;c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b},makeeventmodel=function(){var a=[];return{emit:function(b,c){for(var d=[],e=1;e<arguments.length;++e)d[e-1]=arguments[e];for(e=0;e<a.length;){var f=$jscomp.makeIterator(a[e]),h=f.next().value,k=f.next().value;f=f.next().value;if(h===b){f&&(a.splice(e,1),e--);try{k.apply(null,
$jscomp.arrayFromIterable(d))}catch(g){console.error(g)}}e++}},on:function(b,c,d){return a.push([b,c,void 0===d?!1:d])},once:function(b,c){return a.push([b,c,!0])},off:function(b,c){for(var d=0;d<a.length;){var e=$jscomp.makeIterator(a[d]),f=e.next().value;e=e.next().value;f!==b&&b||e!==c&&c?d++:a.splice(d,1)}},onmap:function(b){for(var c in b)a.push([c,b[c],!1])},offmap:function(b){for(var c in b){var d=b[c],e;for(e in a.length){var f=$jscomp.makeIterator(a[e]),h=f.next().value;f=f.next().value;
if(h===c&&f===d){a.splice(e,1);break}}}},listens:function(b,c){for(var d=0,e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next()){var h=$jscomp.makeIterator(f.value);f=h.next().value;h=h.next().value;f!==b&&b||h!==c&&c||d++}return d},listenlen:function(){return a.length}}},extend=function(a,b){for(var c in b)a[c]=b[c];return a};var auth=extend({token:{access:null,refrsh:null},signed:function(){return!!this.token.access},signin:function(a){sessionStorage.setItem("token",JSON.stringify(a));this.token.access=a.access;this.token.refrsh=a.refrsh;this.emit("auth",!0)},signout:function(){sessionStorage.removeItem("token");this.token.access=null;this.token.refrsh=null;this.emit("auth",!1)},signload:function(){try{var a=JSON.parse(sessionStorage.getItem("token"));this.token.access=a.access;this.token.refrsh=a.refrsh;this.emit("auth",
!0)}catch(b){this.token.access=null,this.token.refrsh=null,this.emit("auth",!1)}}},makeeventmodel()),ajaxcc=extend({},makeeventmodel()),fetchajax=function(a,b,c){var d;return fetch(b,{method:a,headers:{Accept:"application/json;charset=utf-8","Content-Type":"application/json;charset=utf-8"},body:c&&JSON.stringify(c)}).then(function(a){d=a;return new Promise(function(b){return a.json().then(function(a){return b(a)}).catch(function(){return b(void 0)})})}).then(function(a){d.data=a;return d})},fetchajaxauth=
function(a,b,c){var d,e={Accept:"application/json;charset=utf-8","Content-Type":"application/json;charset=utf-8"};auth.token.access&&(e.Authorization="Bearer "+auth.token.access);return fetch(b,{method:a,headers:e,body:c&&JSON.stringify(c)}).then(function(e){if(401===e.status&&auth.token.refrsh)return fetchajax("POST","/api/refrsh",{refrsh:auth.token.refrsh}).then(function(e){return e.ok?(auth.signin(e.data),e={Accept:"application/json;charset=utf-8","Content-Type":"application/json;charset=utf-8"},
auth.token.access&&(e.Authorization="Bearer "+auth.token.access),fetch(b,{method:a,headers:e,body:c&&JSON.stringify(c)}).then(function(a){d=a;return new Promise(function(b){return a.json().then(function(a){return b(a)}).catch(function(){return b(void 0)})})})):Promise.reject()});d=e;return new Promise(function(a){return e.json().then(function(b){return a(b)}).catch(function(){return a(void 0)})})}).then(function(a){d.data=a;return d})};var filetmb=function(a){return 1===a.ntmb?"/thumb/"+a.ktmb:"/asst/file-png/"+geticonname(a)+".png"},makemarkercontent=function(a){return'\n<div class="photoinfo">\n\t<ul class="nav nav-tabs" role="tablist">\n\t\t<li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#pict">Thumbnail</a></li>\n\t\t<li class="nav-item"><a class="nav-link" data-toggle="tab" href="#prop">Properties</a></li>\n\t</ul>\n\t<div class="tab-content">\n\t\t<div class="tab-pane active" id="pict">\n\t\t\t<img class="rounded thumb" src="/thumb/'+
a.ktmb+'" alt="'+a.name+' ">\n\t\t\t<div class="d-flex flex-wrap latlng">\n\t\t\t\t<div><div class="name">lat:</div> <div class="value">'+a.latitude.toFixed(6)+'</div></div>\n\t\t\t\t<div><div class="name">lng:</div> <div class="value">'+a.longitude.toFixed(6)+'</div></div>\n\t\t\t\t<div><div class="name">alt:</div> <div class="value">'+(a.altitude||"N/A")+'</div></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="tab-pane fade" id="prop">\n\t\t\t<ul class="prop p-0 m-0"><li>'+filehint(a).join("</li><li>")+
"</li></ul>\n\t\t</div>\n\t</div>\n</div>\n"},filehint=function(a){var b=[];b.push(a.name);a.pref&&b.push("share: "+shareprefix+a.pref);FTtoFG[a.type]!==FG.dir&&b.push("size: "+fmtitemsize(a.size||0));a.time&&b.push("time: "+(new Date(a.time)).toLocaleString());a.title&&b.push("title: "+a.title);a.album&&b.push("album: "+a.album);a.artist&&b.push("artist: "+a.artist);a.composer&&b.push("composer: "+a.composer);a.genre&&b.push("genre: "+a.genre);a.year&&b.push("year: "+a.year);a.track&&(a.track.number||
a.track.total)&&b.push("track: "+(a.track.number||"")+"/"+(a.track.total||""));a.disc&&(a.disc.number||a.disc.total)&&b.push("disc: "+(a.disc.number||"")+"/"+(a.disc.total||""));a.comment&&b.push("comment: "+a.comment.substring(0,80));a.width&&a.height&&b.push("dimension: "+a.width+"x"+a.height);a.model&&b.push("model: "+a.model);a.make&&b.push("manufacturer: "+a.make);a.datetime&&b.push("photo taken: "+(new Date(a.datetime)).toLocaleString());if(a.orientation)switch(a.orientation){case 1:b.push("orientation: normal");
break;case 2:b.push("orientation: horizontal reversed");break;case 3:b.push("orientation: flipped");break;case 4:b.push("orientation: flipped & horizontal reversed");break;case 5:b.push("orientation: clockwise turned & horizontal reversed");break;case 6:b.push("orientation: clockwise turned");break;case 7:b.push("orientation: anticlockwise turned & horizontal reversed");break;case 8:b.push("orientation: anticlockwise turned")}if(a.exposureprog)switch(a.exposureprog){case 1:b.push("exposure program: manual");
break;case 2:b.push("exposure program: normal program");break;case 3:b.push("exposure program: aperture priority");break;case 4:b.push("exposure program: shutter priority");break;case 5:b.push("exposure program: creative program (depth of field)");break;case 6:b.push("exposure program: action program (fast shutter speed)");break;case 7:b.push("exposure program: portrait mode (background out of focus)");break;case 8:b.push("exposure program: landscape mode (background in focus)")}a.exposuretime&&b.push("exposure time: "+
a.exposuretime+" sec");a.fnumber&&b.push("F-number: f/"+a.fnumber);a.isospeed&&b.push("ISO speed rating: ISO-"+a.isospeed);a.shutterspeed&&b.push("shutter speed: "+a.shutterspeed);a.aperture&&b.push("lens aperture: "+a.aperture);a.exposurebias&&b.push("exposure bias: "+a.exposurebias);if(a.lightsource)switch(a.lightsource){case 1:b.push("light source: daylight");break;case 2:b.push("light source: fluorescent");break;case 3:b.push("light source: tungsten (incandescent light)");break;case 4:b.push("light source: flash");
break;case 9:b.push("light source: fine weather");break;case 10:b.push("light source: cloudy weather");break;case 11:b.push("light source: shade");break;case 12:b.push("light source: daylight fluorescent (D 5700-7100K)");break;case 13:b.push("light source: day white fluorescent (N 4600-5700K)");break;case 14:b.push("light source: cool white fluorescent (W 3800-4600K)");break;case 15:b.push("light source: white fluorescent (WW 3250-3800K)");break;case 16:b.push("light source: warm white fluorescent (L 2600-3250K)");
break;case 17:b.push("light source: standard light A");break;case 18:b.push("light source: standard light B");break;case 19:b.push("light source: standard light C");break;case 20:b.push("light source: D55");break;case 21:b.push("light source: D65");break;case 22:b.push("light source: D75");break;case 23:b.push("light source: D50");break;case 24:b.push("light source: ISO studio tungsten");break;case 255:b.push("light source: other light source");break;default:b.push("light source: light code #"+a.lightsource)}a.focal&&
b.push("focal length: "+a.focal+" mm");a.focal35mm&&b.push("35mm equivalent focal length: "+a.focal35mm+" mm");a.digitalzoom&&b.push("digital zoom ratio: "+a.digitalzoom);a.flash&&(a.flash&1?b.push("flash fired"):b.push("flash did not fire"),4===(a.flash&6)?b.push("strobe return light: not detected"):6===(a.flash&6)&&b.push("strobe return light: detected"),8===(a.flash&24)?b.push("flash mode: compulsory flash firing"):16===(a.flash&24)?b.push("flash mode: compulsory flash suppression"):24===(a.flash&
24)&&b.push("flash mode: auto"),a.flash&64&&b.push("red-eye reduction supported"));a.uniqueid&&b.push("unique ID: "+a.uniqueid);return b};
Vue.component("file-icon-tag",{template:"#file-icon-tpl",props:["file","state","size"],computed:{fmttitle:function(){return filehint(this.file).join("\n")},webpicon:function(){return 1===this.file.ntmb?"":"/asst/file-webp/"+geticonname(this.file)+".webp"},pngicon:function(){return 1===this.file.ntmb?"/thumb/"+this.file.ktmb:"/asst/file-png/"+geticonname(this.file)+".png"},clsoverlay:function(){switch(this.size){case "smicon":return"smoverlay";case "mdicon":return"mdoverlay";case "lgicon":return"lgoverlay"}},
clsimage:function(){switch(this.size){case "smicon":return"smimage";case "mdicon":return"mdimage";case "lgicon":return"lgimage"}},itemview:function(){return{selected:this.state.selected}}},methods:{onselect:function(){this.$emit("select",this.file)},onopen:function(){this.$emit("open",this.file)}}});
Vue.component("img-icon-tag",{template:"#img-icon-tpl",props:["file","state"],computed:{fmttitle:function(){return filehint(this.file).join("\n")},webpicon:function(){return 1===this.file.ntmb?"":"/asst/file-webp/"+geticonname(this.file)+".webp"},pngicon:function(){return 1===this.file.ntmb?"/thumb/"+this.file.ktmb:"/asst/file-png/"+geticonname(this.file)+".png"},itemview:function(){return{selected:this.state.selected}}},methods:{onselect:function(){this.$emit("select",this.file)},onopen:function(){this.$emit("open",
this.file)}}});var sortbyalpha="name",sortbysize="size",unsorted="",listmodetag={smicon:"file-icon-tag",mdicon:"file-icon-tag",lgicon:"img-icon-tag"},listmoderow={smicon:"align-items-start",mdicon:"align-items-start",lgicon:"align-items-center"},listmodeicon={smicon:"format_align_justify",mdicon:"view_comfy",lgicon:"view_module"},listmodehint={smicon:"small icons",mdicon:"middle icons",lgicon:"large icons"},listmodenext={smicon:"mdicon",mdicon:"lgicon",lgicon:"smicon"},copyTextToClipboard=function(a){var b=document.createElement("textarea");
b.value=a;b.style.position="fixed";b.style.left="0px";b.style.top="0px";document.body.appendChild(b);b.focus();b.select();try{return!document.execCommand("copy")&&"copying text command was failed"}catch(c){return c}finally{document.body.removeChild(b)}};
Vue.component("dir-card-tag",{template:"#dir-card-tpl",props:["list"],data:function(){return{isauth:!1,selfile:null,order:1,listmode:"smicon",iid:makestrid(10)}},computed:{signed:function(){return this.isauth||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname},isvisible:function(){var a=this;(function(){a.list.find(function(b){return b===a.selfile})||(a.selfile=null)})();return 0<this.list.length},sortedlist:function(){var a=this;return this.list.slice().sort(function(b,
c){return a.order*(b.name.toLowerCase()>c.name.toLowerCase()?1:-1)})},clsfilelist:function(){return listmoderow[this.listmode]},dislink:function(){return!this.selfile},disshared:function(){return!this.selfile},clsshared:function(){return{active:this.selfile&&this.selfile.pref}},clsorder:function(){return 0<this.order?"arrow_downward":"arrow_upward"},clslistmode:function(){return listmodeicon[this.listmode]},iconmodetag:function(){return listmodetag[this.listmode]},hintorder:function(){return 0<this.order?
"direct order":"reverse order"},hintlist:function(){return listmodehint[this.listmode]}},methods:{onlink:function(){copyTextToClipboard(window.location.origin+getfileurl(this.selfile,"/path/"))},onshare:function(){this.$emit("share",this.selfile)},onorder:function(){this.order=-this.order},onlistmode:function(){this.listmode=listmodenext[this.listmode]},onselect:function(a){this.selfile=a},onopen:function(a){this.$emit("open",a)},onunselect:function(){this.onselect(null)}},mounted:function(){var a=
this;auth.on("auth",function(b){return a.isauth=b})}});
Vue.component("file-card-tag",{template:"#file-card-tpl",props:["list"],data:function(){return{isauth:!1,selfile:null,playbackfile:null,order:1,sortmode:sortbyalpha,listmode:"smicon",music:!0,video:!0,photo:!0,pdf:!0,books:!0,other:!1,audioonly:!0,viewer:null,iid:makestrid(10)}},computed:{signed:function(){return this.isauth||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname},isvisible:function(){var a=this;(function(){a.list.find(function(b){return b===a.selfile})||(a.selfile=
null,a.closeviewer())})();return 0<this.list.length},playlist:function(){for(var a=this,b=[],c=$jscomp.makeIterator(this.list),d=c.next();!d.done;d=c.next())d=d.value,this.showitem(d)&&b.push(d);this.sortmode===sortbyalpha?b.sort(function(b,c){return a.order*(b.name.toLowerCase()>c.name.toLowerCase()?1:-1)}):this.sortmode===sortbysize&&b.sort(function(b,c){return b.size===c.size?a.order*(b.name.toLowerCase()>c.name.toLowerCase()?1:-1):a.order*(b.size>c.size?1:-1)});return b},clsfilelist:function(){return listmoderow[this.listmode]},
dislink:function(){return!this.selfile},disshared:function(){return!this.selfile},clsshared:function(){return{active:this.selfile&&this.selfile.pref}},clsorder:function(){return 0<this.order?"arrow_downward":"arrow_upward"},clssortmode:function(){switch(this.sortmode){case sortbyalpha:return"sort_by_alpha";case sortbysize:return"sort";case unsorted:return"reorder"}},clslistmode:function(){return listmodeicon[this.listmode]},clsaudio:function(){return{active:this.audioonly}},clsmusic:function(){return{active:this.music}},
clsvideo:function(){return{active:this.video}},clsphoto:function(){return{active:this.photo}},clspdf:function(){return{active:this.pdf}},clsbooks:function(){return{active:this.books}},clsother:function(){return{active:this.other}},iconmodetag:function(){return listmodetag[this.listmode]},hintorder:function(){return 0<this.order?"direct order":"reverse order"},hintsortmode:function(){switch(this.sortmode){case sortbyalpha:return"sort by alpha";case sortbysize:return"sort by size";case unsorted:return"as is unsorted"}},
hintlist:function(){return listmodehint[this.listmode]}},methods:{showitem:function(a){switch(FTtoFG[a.type]){case FG.dir:return!0;case FG.music:return this.music;case FG.video:return this.video;case FG.image:return this.photo;case FG.books:return this.pdf;case FG.texts:return this.books;default:return this.other}},getstate:function(a){return{selected:this.selfile===a,playback:this.playbackfile&&this.playbackfile.name===a.name}},closeviewer:function(){this.viewer&&(this.viewer.close(),this.viewer.visible=
!1,this.viewer=null)},onlink:function(){copyTextToClipboard(window.location.origin+getfileurl(this.selfile))},onshare:function(){this.$emit("share",this.selfile)},onorder:function(){this.order=-this.order},onsortmode:function(){switch(this.sortmode){case sortbyalpha:this.sortmode=sortbysize;break;case sortbysize:this.sortmode=unsorted;break;case unsorted:this.sortmode=sortbyalpha}},onlistmode:function(){this.listmode=listmodenext[this.listmode]},onaudio:function(){this.audioonly=!this.audioonly},
onmusic:function(){this.music=!this.music},onvideo:function(){this.video=!this.video},onphoto:function(){this.photo=!this.photo},onpdf:function(){this.pdf=!this.pdf},onbooks:function(){this.books=!this.books},onother:function(){this.other=!this.other},onselect:function(a){if(this.selfile=a)switch(FTtoFV[a.type]){case FV.none:this.closeviewer();break;case FV.music:this.viewer=this.$refs.mp3player;this.viewer.setup(a);this.viewer.visible=!0;break;case FV.video:this.audioonly?this.closeviewer():(this.viewer=
this.$refs.mp3player,this.viewer.setup(a),this.viewer.visible=!0);break;case FV.image:this.closeviewer();break;default:this.closeviewer()}else this.closeviewer()},onopen:function(a){switch(FTtoFV[a.type]){case FV.image:this.closeviewer();this.$refs.slider.popup(a);break;default:var b=getfileurl(a);window.open(b,a.name)}},onunselect:function(){this.onselect(null)},onplayback:function(a){this.playbackfile=a}},mounted:function(){var a=this;auth.on("auth",function(b){return a.isauth=b})}});
Vue.component("map-card-tag",{template:"#map-card-tpl",data:function(){return{map:null,markers:null,markermode:"thumb",gpslist:[],iid:makestrid(10)}},computed:{isvisible:function(){return 0<this.gpslist.length},iconmarkermode:function(){switch(this.markermode){case "marker":return"place";case "thumb":return"local_see"}},hintmarkermode:function(){switch(this.markermode){case "marker":return"photo positions by markers";case "thumb":return"photo positions by thumbnails"}}},methods:{new:function(){if(!this.markers||
0<this.gpslist.length)this.markers&&this.map.removeLayer(this.markers),this.markers=L.markerClusterGroup(),this.map.addLayer(this.markers),this.gpslist=[]},addmarkers:function(a){var b=this;if(a.length){for(var c={},d=$jscomp.makeIterator(a),e=d.next();!e.done;c={$jscomp$loop$prop$file$32:c.$jscomp$loop$prop$file$32},e=d.next()){c.$jscomp$loop$prop$file$32=e.value;e={title:c.$jscomp$loop$prop$file$32.name,riseOnHover:!0};"thumb"===this.markermode&&c.$jscomp$loop$prop$file$32.ktmb&&(e.icon=L.divIcon({html:'<img src="'+
filetmb(c.$jscomp$loop$prop$file$32)+'">',className:"photomarker",iconSize:[60,60],iconAnchor:[30,30],popupAnchor:[0,-15]}));var f=document.createElement("template");f.innerHTML=makemarkercontent(c.$jscomp$loop$prop$file$32).trim();f=f.content.firstChild;f.querySelector(".photoinfo img.thumb").addEventListener("click",function(a){return function(){b.$refs.slider.popup(a.$jscomp$loop$prop$file$32)}}(c));L.marker([c.$jscomp$loop$prop$file$32.latitude,c.$jscomp$loop$prop$file$32.longitude],e).addTo(this.markers).bindPopup(f)}var h=
!this.gpslist.length;Vue.nextTick(function(){h&&b.map.invalidateSize();b.map.flyToBounds(b.markers.getBounds(),{padding:[20,20]})});this.gpslist.push.apply(this.gpslist,$jscomp.arrayFromIterable(a))}},onmarkermode:function(){switch(this.markermode){case "marker":this.markermode="thumb";break;case "thumb":this.markermode="marker"}var a=this.gpslist;this.new();this.addmarkers(a)},onfitbounds:function(){this.map.flyToBounds(this.markers.getBounds(),{padding:[20,20]})}},mounted:function(){var a=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",
{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, Imagery &copy <a href="https://www.mapbox.com/" target="_blank">Mapbox</a>',minZoom:2,id:"mapbox.streets-satellite"});this.map=L.map(this.$refs.map,{center:[0,0],zoom:8,layers:[a]})}});var mp3filter=function(a){return FTtoFV[a.type]===FV.music||FTtoFV[a.type]===FV.video};
Vue.component("mp3-player-tag",{template:"#mp3-player-tpl",props:["list"],data:function(){return{visible:!1,selfile:{},rate:1,volume:1,repeatmode:0,seeking:!1,media:null,isplay:!1,isflowing:!1,ready:!1,timecur:0,timebuf:0,timeend:0,iid:makestrid(10)}},computed:{selfilepos:function(){for(var a in this.list)if(this.selfile.path===this.list[a].path)return Number(a)},getprev:function(){var a=this,b=function(b,d){for(--b;b>d;b--){var c=a.list[b];if(mp3filter(c))return c}};return b(this.selfilepos,-1)||
2===this.repeatmode&&b(this.list.length,this.selfilepos)},getnext:function(){var a=this,b=function(b,d){for(b+=1;b<d;b++){var c=a.list[b];if(mp3filter(c))return c}};return b(this.selfilepos,this.list.length)||2===this.repeatmode&&b(-1,this.selfilepos)},iconplay:function(){return this.isplay?"pause":"play_arrow"},hintplay:function(){return this.isplay?"pause":"play"},iconrepeat:function(){return 1===this.repeatmode?"repeat_one":"repeat"},hintrepeat:function(){switch(this.repeatmode){case 0:return"no any repeat";
case 1:return"repeat one";case 2:return"repeat playlist"}},fmttimecur:function(){return fmttime(this.timecur,this.timeend)},fmttimeend:function(){return fmttime(this.timeend,this.timeend)},fmttrackinfo:function(){return this.selfile.title?(this.selfile.artist||this.selfile.album||this.selfile.genre||"")+" - "+this.selfile.title:this.selfile.name},stlbarcur:function(){return{width:(Infinity===this.timeend?95:!this.timeend||isNaN(this.timeend)?5:this.timecur/this.timeend*100)+"%"}},stlbarbuf:function(){return{width:(Infinity===
this.timeend?0:!this.timeend||isNaN(this.timeend)?0:this.timebuf/this.timeend*100)+"%"}}},methods:{setup:function(a){var b=this;this.selfile.path!==a.path&&(this.close(),this.selfile=a,this.media=new Audio(getfileurl(a)),this.media.playbackRate=this.rate,this.media.loop=1===this.repeatmode,this.ready=!1,this.media.addEventListener("loadedmetadata",function(){b.updateprogress()}),this.media.addEventListener("canplay",function(){var a=b.media.duration;b.timecur=b.media.currentTime;b.timebuf=0;b.timeend=
a;b.ready=!0;b.isflowing&&(b.media.play(),b.isplay=!0,b.$emit("playback",b.selfile))}),this.media.addEventListener("timeupdate",function(){return b.updateprogress()}),this.media.addEventListener("seeked",function(){return b.updateprogress()}),this.media.addEventListener("progress",function(){return b.updateprogress()}),this.media.addEventListener("play",function(){}),this.media.addEventListener("pause",function(){}),this.media.addEventListener("ended",function(){b.isplay=!1;b.$emit("playback",null);
b.onnext()}))},close:function(){return this.media&&!this.media.paused?(this.media.pause(),this.isplay=!1,this.$emit("playback",null),!0):!1},setrate:function(a){this.rate=a;this.media&&(this.media.playbackRate=a)},play:function(){this.media&&(this.media.paused?(this.media.play(),this.isflowing=this.isplay=!0,this.$emit("playback",this.selfile)):(this.media.pause(),this.isflowing=this.isplay=!1,this.$emit("playback",null)))},updateprogress:function(){var a=this.media.currentTime;this.seeking||(this.timecur=
a);if(0<this.media.buffered.length){var b=this.media.buffered.start(0),c=this.media.buffered.end(0);this.timebuf=b<=a&&c>a?c-a:0}else this.timebuf=0},onprev:function(){this.getprev&&this.$emit("select",this.getprev)},onplay:function(){this.play()},onnext:function(){this.getnext&&this.$emit("select",this.getnext)},onrepeat:function(){this.repeatmode=(this.repeatmode+1)%(this.list?3:2);this.media&&(this.media.loop=1===this.repeatmode)},onseekerchange:function(a){this.media.currentTime=a.target.value;
this.seeking=!1},onseekerinput:function(a){this.seeking=!0;this.timecur=Number(a.target.value)}}});var photofilter=function(a){return FTtoFV[a.type]===FV.image||FTtoFV[a.type]===FV.video};
Vue.component("thumbslider-tag",{template:"#thumbslider-tpl",props:["selfile","list"],computed:{slide:function(){for(var a=[],b=$jscomp.makeIterator(this.list),c=b.next();!c.done;c=b.next())c=c.value,1===c.ntmb&&a.push(c);return a}},methods:{onprev:function(){this.$refs.slide.scrollBy({left:-120,behavior:"smooth"})},onnext:function(){this.$refs.slide.scrollBy({left:120,behavior:"smooth"})},onthumb:function(a){this.$emit("select",a)}}});
Vue.component("photoslider-tag",{template:"#photoslider-tpl",props:["list"],data:function(){return{visible:!1,selfile:null,selfileurl:null,repeatmode:0}},computed:{selfilepos:function(){for(var a in this.list)if(this.selfile.path===this.list[a].path)return Number(a)},getprev:function(){var a=this,b=function(b,d){for(--b;b>d;b--){var c=a.list[b];if(photofilter(c))return c}};return this.selfile&&(b(this.selfilepos,-1)||2===this.repeatmode&&b(this.list.length,this.selfilepos))},getnext:function(){var a=
this,b=function(b,d){for(b+=1;b<d;b++){var c=a.list[b];if(photofilter(c))return c}};return this.selfile&&(b(this.selfilepos,this.list.length)||2===this.repeatmode&&b(-1,this.selfilepos))},islist:function(){return this.list&&1<this.list.length}},methods:{select:function(a){this.selfile=a;this.selfileurl=getfileurl(a);this.$emit("select",a)},popup:function(a){var b=this;this.selfile=a;this.selfileurl=getfileurl(a);this.visible=!0;Vue.nextTick(function(){b.$refs.wall.focus()})},close:function(){this.selfileurl=
this.selfile=null;this.visible=!1},onkeyup:function(a){switch(a.code){case "Escape":this.close();break;case "ArrowLeft":this.onprev();break;case "ArrowRight":case "Space":this.onnext();break;case "Home":this.list&&this.select(this.list[0]);break;case "End":this.list&&this.select(this.list[this.list.length-1])}},onselect:function(a){this.select(a)},onprev:function(){this.getprev&&this.select(this.getprev)},onnext:function(){this.getnext&&this.select(this.getnext)},onclose:function(){this.close()}}});var FT={drive:-2,dir:-1,file:0,wave:1,flac:2,mp3:3,ogg:4,mp4:5,webm:6,photo:7,tga:8,bmp:9,gif:10,png:11,jpeg:12,tiff:13,webp:14,pdf:15,html:16,text:17,scr:18,cfg:19,log:20,cab:21,zip:22,rar:23},FG={other:0,music:1,video:2,image:3,books:4,texts:5,store:6,dir:7},$jscomp$compprop0={},FTtoFG=($jscomp$compprop0[FT.drive]=FG.dir,$jscomp$compprop0[FT.dir]=FG.dir,$jscomp$compprop0[FT.file]=FG.other,$jscomp$compprop0[FT.wave]=FG.music,$jscomp$compprop0[FT.flac]=FG.music,$jscomp$compprop0[FT.mp3]=FG.music,
$jscomp$compprop0[FT.ogg]=FG.video,$jscomp$compprop0[FT.mp4]=FG.video,$jscomp$compprop0[FT.webm]=FG.video,$jscomp$compprop0[FT.photo]=FG.image,$jscomp$compprop0[FT.tga]=FG.image,$jscomp$compprop0[FT.bmp]=FG.image,$jscomp$compprop0[FT.gif]=FG.image,$jscomp$compprop0[FT.png]=FG.image,$jscomp$compprop0[FT.jpeg]=FG.image,$jscomp$compprop0[FT.tiff]=FG.image,$jscomp$compprop0[FT.webp]=FG.image,$jscomp$compprop0[FT.pdf]=FG.books,$jscomp$compprop0[FT.html]=FG.books,$jscomp$compprop0[FT.text]=FG.texts,$jscomp$compprop0[FT.scr]=
FG.texts,$jscomp$compprop0[FT.cfg]=FG.texts,$jscomp$compprop0[FT.log]=FG.texts,$jscomp$compprop0[FT.cab]=FG.store,$jscomp$compprop0[FT.zip]=FG.store,$jscomp$compprop0[FT.rar]=FG.store,$jscomp$compprop0),FV={none:0,music:1,video:2,image:3},$jscomp$compprop1={},FTtoFV=($jscomp$compprop1[FT.drive]=FV.none,$jscomp$compprop1[FT.dir]=FV.none,$jscomp$compprop1[FT.file]=FV.none,$jscomp$compprop1[FT.wave]=FV.music,$jscomp$compprop1[FT.flac]=FV.music,$jscomp$compprop1[FT.mp3]=FV.music,$jscomp$compprop1[FT.ogg]=
FV.video,$jscomp$compprop1[FT.mp4]=FV.video,$jscomp$compprop1[FT.webm]=FV.video,$jscomp$compprop1[FT.photo]=FV.image,$jscomp$compprop1[FT.tga]=FV.image,$jscomp$compprop1[FT.bmp]=FV.image,$jscomp$compprop1[FT.gif]=FV.image,$jscomp$compprop1[FT.png]=FV.image,$jscomp$compprop1[FT.jpeg]=FV.image,$jscomp$compprop1[FT.tiff]=FV.image,$jscomp$compprop1[FT.webp]=FV.image,$jscomp$compprop1[FT.pdf]=FV.none,$jscomp$compprop1[FT.html]=FV.none,$jscomp$compprop1[FT.text]=FV.none,$jscomp$compprop1[FT.scr]=FV.none,
$jscomp$compprop1[FT.cfg]=FV.none,$jscomp$compprop1[FT.log]=FV.none,$jscomp$compprop1[FT.cab]=FV.none,$jscomp$compprop1[FT.zip]=FV.none,$jscomp$compprop1[FT.rar]=FV.none,$jscomp$compprop1),root={name:"",path:"",size:0,time:0,type:FT.dir},shareprefix="/file/",geticonname=function(a){switch(a.type){case FT.drive:return"drive";case FT.dir:var b=app.curpathshares.length?"-pub":"";if(a.scan){var c=0;a=a.fgrp;for(var d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())c+=e.value;return c?.5<a[FG.music]/
c?"folder-mp3"+b:.5<a[FG.video]/c?"folder-movies"+b:.5<a[FG.image]/c?"folder-photo"+b:.5<a[FG.books]/c?"folder-doc"+b:.5<a[FG.texts]/c?"folder-doc"+b:.5<a[FG.dir]/c?"folder-sub"+b:.5<(a[FG.music]+a[FG.video]+a[FG.image])/c?"folder-media"+b:"folder-empty"+b:"folder-empty"+b}return"folder-close"+b;case FT.wave:return"doc-wave";case FT.flac:return"doc-flac";case FT.mp3:return"doc-mp3";case FT.ogg:return"doc-music";case FT.mp4:return"doc-mp4";case FT.webm:return"doc-movie";case FT.photo:return"doc-photo";
case FT.tga:case FT.bmp:return"doc-bitmap";case FT.gif:return"doc-gif";case FT.png:return"doc-png";case FT.jpeg:case FT.tiff:return"doc-jpeg";case FT.webp:return"doc-webp";case FT.pdf:return"doc-pdf";case FT.html:return"doc-html";case FT.text:return"doc-text";case FT.scr:return"doc-script";case FT.cfg:return"doc-config";case FT.log:return"doc-log";case FT.cab:return"doc-cab";case FT.zip:return"doc-zip";case FT.rar:return"doc-rar";default:return"doc-file"}},encode=function(a){return encodeURI(a).replace("#",
"%23").replace("&","%26").replace("+","%2B")},getfileurl=function(a,b){b=b||shareprefix;if(a.pref)b+=a.pref;else if(app.curpathshares.length){var c=app.curpathshares[0];b+=encode(c.pref+"/"+c.suff+a.name);FTtoFG[a.type]===FG.dir&&(b+="/")}else b+=encode(a.path);return b},showmsgbox=function(a,b){var c=$("#msgbox");c.find(".modal-title").html(a);c.find(".modal-body").html(b);c.modal("show")},ajaxfail=function(){showmsgbox("Server unavailable","Server is currently not available, action can not be done now.")},
onerr404=function(){showmsgbox("Invalid path","Specified path cannot be accessed now.")},app=new Vue({el:"#app",template:"#app-tpl",data:{isauth:!1,password:"",passstate:0,loadcount:0,shared:[],pathlist:[],filelist:[],curpath:root,curscan:new Date,histpos:0,histlist:[]},computed:{isadmin:function(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname},signed:function(){return this.isauth||this.isadmin},curpathway:function(){if(!this.curpath.name)return[];var a=this.curpath.path.split("/");
a.pop()||a.pop();var b=[],c="";a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())d=d.value,c+=d+"/",b.push({name:d,path:c,size:0,time:0,type:FT.dir});return b},curpathshares:function(){for(var a=[],b=this.curpath.path,c=$jscomp.makeIterator(this.shared),d=c.next();!d.done;d=c.next())d=d.value,d.path.length<=b.length&&b.substr(0,d.path.length)===d.path&&(d=Object.assign({},d),d.suff=b.substr(d.path.length,b.length),a.push(d));return a},uncached:function(){for(var a=[],b=$jscomp.makeIterator(this.filelist),
c=b.next();!c.done;c=b.next())c=c.value,c.ntmb||a.push(c);return a},sumsize:function(){for(var a=0,b=$jscomp.makeIterator(this.filelist),c=b.next();!c.done;c=b.next())a+=c.value.size||0;return fmtitemsize(a)},dishome:function(){return!this.curpath.name},disback:function(){return 2>this.histpos},disforward:function(){return this.histpos>this.histlist.length-1},disparent:function(){return!this.curpathway.length},clspass:function(){return this.passstate?-1===this.passstate?"is-invalid":"is-valid":""},
hintback:function(){if(2>this.histpos)return"go back";var a=this.histlist[this.histpos-2].name;a||(a="root folder");return"go back to "+a},hintforward:function(){if(this.histpos>this.histlist.length-1)return"go forward";var a=this.histlist[this.histpos].name;a||(a="root folder");return"go forward to "+a},hintparent:function(){return this.curpathway.length?this.curpathway.map(function(a){return a.name}).join("/"):"to root folder"}},methods:{fetchfolder:function(a){var b=this;return fetchajaxauth("GET",
"/api/folder?"+$.param({path:a.path})).then(function(c){traceajax(c);b.pathlist=[];b.filelist=[];b.curpath=a;window.history.replaceState(a,a.path,(devmode?"/dev":"")+"/path/"+a.path);b.$refs.mapcard.new();if(c.ok){b.curscan=new Date(Date.now());for(var d=c.data.paths||[],e=$jscomp.makeIterator(d),f=e.next();!f.done;f=e.next())f=f.value,f.path=f.pref?f.pref:a.path+f.name,f.path+="/";c=c.data.files||[];e=$jscomp.makeIterator(c);for(f=e.next();!f.done;f=e.next())f=f.value,f.path=f.pref?f.pref:a.path+
f.name;b.pathlist=d;b.filelist=c;if(!a.path)for(b.shared=[],d=$jscomp.makeIterator(b.pathlist),f=d.next();!f.done;f=d.next())f=f.value,f.pref&&b.shared.push(f);d=[];c=$jscomp.makeIterator(c);for(f=c.next();!f.done;f=c.next())f=f.value,f.latitude&&f.longitude&&1===f.ntmb&&d.push(f);b.$refs.mapcard.addmarkers(d)}else 401===c.status?onerr404():404===c.status&&onerr404();if(b.uncached.length){var h=function(){for(var c=[],d=$jscomp.makeIterator(b.uncached),e=d.next();!e.done;e=d.next())c.push({ktmb:e.value.ktmb});
fetchajaxauth("POST","/api/tmb/chk",{tmbs:c}).then(function(c){traceajax(c);if(c.ok){var d=[];c=$jscomp.makeIterator(c.data.tmbs);for(var e=c.next();!e.done;e=c.next())if(e=e.value,e.ntmb)for(var f=$jscomp.makeIterator(b.filelist),g=f.next();!g.done;g=f.next())if(g=g.value,g.ktmb===e.ktmb){Vue.set(g,"ntmb",e.ntmb);g.latitude&&g.longitude&&1===g.ntmb&&d.push(g);break}b.$refs.mapcard.addmarkers(d);b.uncached.length&&b.curpath===a&&setTimeout(h,1500)}})};setTimeout(h,600);d=[];c=$jscomp.makeIterator(b.uncached);
for(f=c.next();!f.done;f=c.next())d.push(f.value.path);fetchajaxauth("POST","/api/tmb/scn",{paths:d,force:!1}).then(function(a){traceajax(a)})}})},fetchopenfolder:function(a){var b=this;return this.fetchfolder(a).then(function(){b.histpos<b.histlist.length&&b.histlist.splice(b.histpos,b.histlist.length-b.histpos);b.histlist.push(a);b.histpos=b.histlist.length})},fetchsharelist:function(){var a=this;return fetchajaxauth("POST","/api/share/lst").then(function(b){traceajax(b);if(b.ok){a.shared=[];b=
$jscomp.makeIterator(b.data);for(var c=b.next();!c.done;c=b.next())(c=c.value)&&FTtoFG[c.type]===FG.dir&&(c.path=c.pref+"/",a.shared.push(c))}})},fetchshareadd:function(a){var b=this;return fetchajaxauth("POST","/api/share/add?"+$.param({path:a.path})).then(function(c){traceajax(c);if(c.ok){if(c=c.data)Vue.set(a,"pref",c.pref),FTtoFG[c.type]===FG.dir&&(c.path=c.pref+"/",b.shared.push(c))}else 404===c.status&&(onerr404(),FTtoFG[a.type]===FG.dir?b.pathlist.splice(b.pathlist.findIndex(function(b){return b===
a}),1):b.filelist.splice(b.filelist.findIndex(function(b){return b===a}),1))})},fetchsharedel:function(a){var b=this;return fetchajaxauth("DELETE","/api/share/del?"+$.param({pref:a.pref})).then(function(c){traceajax(c);if(c.ok){if(c.data){if(c=FTtoFG[a.type]===FG.dir)for(var d in b.shared)if(b.shared[d].pref===a.pref){b.shared.splice(d,1);break}Vue.delete(a,"pref");b.curpath.path?(a.path=b.curpath.path+a.name,c&&(a.path+="/")):c?b.pathlist.splice(b.pathlist.findIndex(function(b){return b===a}),1):
b.filelist.splice(b.filelist.findIndex(function(b){return b===a}),1)}}else 404===xhr.status&&(onerr404(),FTtoFG[a.type]===FG.dir?b.pathlist.splice(b.pathlist.findIndex(function(b){return b===a}),1):b.filelist.splice(b.filelist.findIndex(function(b){return b===a}),1))})},onhome:function(){ajaxcc.emit("ajax",1);this.fetchopenfolder(root).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})},onback:function(){this.histpos--;var a=this.histlist[this.histpos-1];ajaxcc.emit("ajax",1);this.fetchfolder(a).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",
-1)})},onforward:function(){this.histpos++;var a=this.histlist[this.histpos-1];ajaxcc.emit("ajax",1);this.fetchfolder(a).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})},onparent:function(){var a=this.curpathway.length?this.curpathway[this.curpathway.length-1]:root;ajaxcc.emit("ajax",1);this.fetchopenfolder(a).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})},onrefresh:function(){var a=this,b=this.curpath;ajaxcc.emit("ajax",1);this.fetchfolder(b).then(function(){return a.fetchsharelist()}).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",
-1)})},onshare:function(a){a.pref?(ajaxcc.emit("ajax",1),this.fetchsharedel(a).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})):(ajaxcc.emit("ajax",1),this.fetchshareadd(a).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)}))},onpathopen:function(a){ajaxcc.emit("ajax",1);this.fetchopenfolder(a).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})},onpasschange:function(){this.passstate=0},onlogin:function(){var a=this;ajaxcc.emit("ajax",1);fetchajax("POST",
"/api/pubkey").then(function(b){traceajax(b);if(b.ok){var c=sha256.hmac.create(b.data);c.update(a.password);return fetchajax("POST","/api/signin",{pubk:b.data,hash:c.digest()})}return Promise.reject()}).then(function(b){traceajax(b);200===b.status?(auth.signin(b.data),a.passstate=1,a.onrefresh()):403===b.status&&(auth.signout(),a.passstate=-1)}).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})},onlogout:function(){auth.signout();this.passstate=0;this.onrefresh()}},mounted:function(){var a=
this;auth.on("auth",function(b){return a.isauth=b});ajaxcc.on("ajax",function(b){return a.loadcount+=b})}});
$(document).ready(function(){auth.signload();devmode&&console.log("token:",auth.token);var a=window.location.pathname;devmode&&(a=a.substr(4));var b=decodeURI(a.substr(6));if(b&&"/path/"===a.substr(0,6)){a=b.split("/");var c=!a[a.length-1];b={name:a[a.length-(c?2:1)],path:b+(c?"":"/"),size:0,time:0,type:FT.dir};ajaxcc.emit("ajax",1);app.fetchopenfolder(b).then(function(){return app.fetchsharelist()}).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",-1)})}else ajaxcc.emit("ajax",1),app.fetchopenfolder(root).catch(ajaxfail).finally(function(){return ajaxcc.emit("ajax",
-1)});$(".preloader").hide("fast");$("#app").show("fast")});
